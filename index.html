<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<script src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
  <title>æ–‡ä»¶ä¸Šä¼ </title>
  <style>
    /* åŸºç¡€æ ·å¼ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    }
    
    body {
      background-color: #f9f9f9;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }
    
    .container {
      width: 100%;
      max-width: 400px;
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      padding: 24px;
    }
    
    /* æ ‡é¢˜æ ·å¼ */
    .title-area {
      text-align: center;
      margin-bottom: 32px;
    }
    
    .title {
      font-size: 20px;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
    }
    
    .subtitle {
      font-size: 14px;
      color: #666;
    }
    
    /* é€‰æ‹©æ¨¡å¼æ ·å¼ */
    .select-mode {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .mode-option {
      display: flex;
      align-items: center;
      cursor: pointer;
    }
    
    .mode-option input {
      width: 16px;
      height: 16px;
      margin-right: 8px;
      accent-color: #37C2FF;
    }
    
    .mode-option label {
      font-size: 14px;
      color: #333;
      cursor: pointer;
    }
    
    /* ä¸Šä¼ æŒ‰é’®æ ·å¼ */
    .upload-btn {
      width: 100%;
      padding: 12px;
      background-color: #37C2FF;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.2s;
      margin-bottom: 16px;
    }
    
    .upload-btn:hover {
      background-color: #29b8ff;
    }
    
    .upload-btn:disabled {
      background-color: #b3e0ff;
      cursor: not-allowed;
    }
    
    .upload-btn i {
      margin-right: 8px;
    }
    
    /* çŠ¶æ€æ¶ˆæ¯æ ·å¼ */
    .status-message {
      display: none;
      text-align: center;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 16px;
      font-size: 14px;
    }
    
    .status-success {
      display: block;
      background-color: #f0fff4;
      color: #00b42a;
      border: 1px solid #b3f0c5;
    }
    
    .status-error {
      display: block;
      background-color: #fff0f0;
      color: #f53f3f;
      border: 1px solid #ffd2d2;
    }
    
    /* éšè—çš„æ–‡ä»¶è¾“å…¥ */
    #fileInput {
      display: none;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- æ ‡é¢˜åŒºåŸŸ -->
    <div class="title-area">
      <h1 class="title">æ–‡ä»¶ä¸Šä¼ </h1>
      <p class="subtitle">æ”¯æŒæ‰€æœ‰ç±»å‹æ–‡ä»¶çš„ä¸Šä¼ </p>
    </div>
    
    <!-- é€‰æ‹©æ¨¡å¼ -->
    <div class="select-mode">
      <div class="mode-option">
        <input type="radio" name="selectMode" id="singleMode" value="single" checked>
        <label for="singleMode">å•ä¸ªæ–‡ä»¶</label>
      </div>
      <div class="mode-option">
        <input type="radio" name="selectMode" id="multipleMode" value="multiple">
        <label for="multipleMode">å¤šä¸ªæ–‡ä»¶</label>
      </div>
    </div>
    
    <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
    <input type="file" id="fileInput" accept="*/*">
    
    <!-- ä¸Šä¼ æŒ‰é’® -->
    <button id="uploadBtn" class="upload-btn">
      <span>ğŸ“¤</span> é€‰æ‹©å¹¶ä¸Šä¼ æ–‡ä»¶
    </button>
    
    <!-- çŠ¶æ€æç¤º -->
    <div id="statusMessage" class="status-message"></div>
  </div>

  <script>
    // DOMå…ƒç´ 
    const uploadBtn = document.getElementById('uploadBtn');
    const fileInput = document.getElementById('fileInput');
    const statusMessage = document.getElementById('statusMessage');
    const singleModeRadio = document.getElementById('singleMode');
    const multipleModeRadio = document.getElementById('multipleMode');

	  try{
		// H5 ä¸­é‡å†™ console.logï¼ŒåŒæ—¶å‘é€åˆ°å°ç¨‹åº
		const originalLog = console.log;
		console.log = function(...args) {
		  // 1. ä¿ç•™ H5 è‡ªèº«çš„æ—¥å¿—ï¼ˆæ–¹ä¾¿ç”µè„‘ç«¯è°ƒè¯•ï¼‰
		  originalLog.apply(console, args);
		  
		  // 2. ä¼ é€’æ—¥å¿—åˆ°å°ç¨‹åºï¼ˆéœ€ç¡®ä¿ wx å¯¹è±¡å­˜åœ¨ï¼‰
		  if (window.wx?.miniProgram) {
		    wx.miniProgram.postMessage({
		      data: {
		        type: 'h5_log',
		        content: args.join(' ') // å°†æ—¥å¿—å‚æ•°è½¬ä¸ºå­—ç¬¦ä¸²
		      }
		    });
		  }
		};
		
	  }catch{}
	  
    // æ£€æŸ¥æ˜¯å¦åœ¨å¾®ä¿¡å°ç¨‹åºç¯å¢ƒ
    function isWechatMiniProgram() {
      const userAgent = window.navigator.userAgent.toLowerCase();
      return userAgent.includes('miniprogram');
    }
    
    // æ›´æ–°æ–‡ä»¶é€‰æ‹©æ¨¡å¼
    function updateFileSelectionMode() {
      const isMultiple = multipleModeRadio.checked;
      fileInput.multiple = isMultiple;
    }
    
    // ç»‘å®šé€‰æ‹©æ¨¡å¼å˜æ›´äº‹ä»¶
    singleModeRadio.addEventListener('change', updateFileSelectionMode);
    multipleModeRadio.addEventListener('change', updateFileSelectionMode);
    
    // ç‚¹å‡»ä¸Šä¼ æŒ‰é’®è§¦å‘æ–‡ä»¶é€‰æ‹©
    uploadBtn.addEventListener('click', () => {
      updateFileSelectionMode();
      fileInput.click();
    });
    
    // å¤„ç†é€‰æ‹©çš„æ–‡ä»¶
    fileInput.addEventListener('change', () => {
      if (fileInput.files.length > 0) {
        handleFiles(fileInput.files);
      }
    });
    
    // å¤„ç†æ–‡ä»¶
    function handleFiles(files) {
      // ç¦ç”¨ä¸Šä¼ æŒ‰é’®
      uploadBtn.disabled = true;
      uploadBtn.innerHTML = '<span>âŒ›</span> å¤„ç†ä¸­...';
      
      // è½¬æ¢æ–‡ä»¶ä¿¡æ¯ä¸ºå¯ä¼ è¾“æ ¼å¼
      const fileInfoList = Array.from(files).map(file => ({
        name: file.name,
        size: file.size,
        type: file.type,
        lastModified: file.lastModified,
        lastModifiedDate: new Date(file.lastModified).toISOString()
      }));
      
      // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
      statusMessage.textContent = 'æ–‡ä»¶å¤„ç†å®Œæˆ';
      statusMessage.className = 'status-message status-success';
      // åˆ¤æ–­ç¯å¢ƒå¹¶æ‰§è¡Œç›¸åº”æ“ä½œ
      if (isWechatMiniProgram()) {
        // å¾®ä¿¡å°ç¨‹åºç¯å¢ƒï¼šè¿”å›ä¸Šä¸€é¡µå¹¶ä¼ é€’æ–‡ä»¶ä¿¡æ¯
        handleMiniProgramUpload(fileInfoList);
      } else {
        // Webç¯å¢ƒï¼šæ‰“å°æ–‡ä»¶ä¿¡æ¯
        handleWebUpload(fileInfoList);
      }
    }
    
    // å¤„ç†å°ç¨‹åºç¯å¢ƒä¸‹çš„ä¸Šä¼ 
    function handleMiniProgramUpload(fileInfoList) {
      // å»¶è¿Ÿå¤„ç†ï¼Œè®©ç”¨æˆ·çœ‹åˆ°çŠ¶æ€æç¤º
      setTimeout(() => {
        try {
          // å‘å°ç¨‹åºå‘é€æ¶ˆæ¯
			console.log(window, 'window')
			console.log(wx, 'wx')
          if (window.wx && wx.miniProgram) {
            wx.miniProgram.postMessage({
              data: {
                type: 'fileUploadComplete',
                files: fileInfoList
              }
            });
            
            // è¿”å›ä¸Šä¸€é¡µ
            wx.miniProgram.navigateBack({
              delta: 1
            });
          } else {
            // å…¼å®¹å¤„ç†
            history.back();
          }
        } catch (e) {
          console.error('å°ç¨‹åºé€šä¿¡å¤±è´¥:', e);
          statusMessage.textContent = 'å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•';
          statusMessage.className = 'status-message status-error';
          resetUploadButton();
        }
      }, 800);
    }
    
    // å¤„ç†Webç¯å¢ƒä¸‹çš„ä¸Šä¼ 
    function handleWebUpload(fileInfoList) {
      // å»¶è¿Ÿå¤„ç†ï¼Œè®©ç”¨æˆ·çœ‹åˆ°çŠ¶æ€æç¤º
      setTimeout(() => {
        printFileInfo(fileInfoList);
        // é‡ç½®ä¸Šä¼ æŒ‰é’®çŠ¶æ€ï¼Œå…è®¸å†æ¬¡ä¸Šä¼ 
        resetUploadButton();
      }, 800);
    }
    
    // æ‰“å°æ–‡ä»¶ä¿¡æ¯
    function printFileInfo(files) {
		console.log(files, 'filesaaaaa')
      // // åˆ›å»ºä¸€ä¸ªæ–°çª—å£ç”¨äºæ‰“å°
      // const printWindow = window.open('', '_blank');
      
      // // æ„å»ºæ‰“å°å†…å®¹
      // let printContent = `
      //   <!DOCTYPE html>
      //   <html>
      //   <head>
      //     <title>æ–‡ä»¶ä¿¡æ¯æ‰“å°</title>
      //     <style>
      //       body { font-family: Arial, sans-serif; padding: 20px; }
      //       h1 { color: #333; border-bottom: 2px solid #37C2FF; padding-bottom: 10px; }
      //       .file-item { margin: 15px 0; padding: 10px; border: 1px solid #eee; border-radius: 4px; }
      //       .file-property { margin: 5px 0; }
      //       .label { font-weight: bold; color: #555; }
      //     </style>
      //   </head>
      //   <body>
      //     <h1>ä¸Šä¼ æ–‡ä»¶ä¿¡æ¯</h1>
      //     <p>å…± ${files.length} ä¸ªæ–‡ä»¶</p>
      //     <div class="file-list">
      // `;
      
      // // æ·»åŠ æ¯ä¸ªæ–‡ä»¶çš„ä¿¡æ¯
      // files.forEach((file, index) => {
      //   printContent += `
      //     <div class="file-item">
      //       <div class="file-property"><span class="label">æ–‡ä»¶ ${index + 1}ï¼š</span> ${file.name}</div>
      //       <div class="file-property"><span class="label">ç±»å‹ï¼š</span> ${file.type || 'æœªçŸ¥'}</div>
      //       <div class="file-property"><span class="label">å¤§å°ï¼š</span> ${formatFileSize(file.size)}</div>
      //       <div class="file-property"><span class="label">ä¿®æ”¹æ—¶é—´ï¼š</span> ${new Date(file.lastModified).toLocaleString()}</div>
      //     </div>
      //   `;
      // });
      
      // printContent += `
      //     </div>
      //   </body>
      //   </html>
      // `;
      
      // // å†™å…¥å†…å®¹å¹¶æ‰“å°
      // printWindow.document.write(printContent);
      // printWindow.document.close();
      // printWindow.focus();
      
      // // è§¦å‘æ‰“å°
      // setTimeout(() => {
      //   printWindow.print();
      // }, 300);
    }
    
    // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    // é‡ç½®ä¸Šä¼ æŒ‰é’®çŠ¶æ€
    function resetUploadButton() {
      uploadBtn.disabled = false;
      uploadBtn.innerHTML = '<span>ğŸ“¤</span> é€‰æ‹©å¹¶ä¸Šä¼ æ–‡ä»¶';
      statusMessage.className = 'status-message';
    }
    
    // åˆå§‹åŒ–å¾®ä¿¡å°ç¨‹åºç¯å¢ƒæ£€æµ‹
    function initWechatMiniProgram() {
      if (typeof wx !== 'undefined' && wx.miniProgram) {
        wx.miniProgram.getEnv((res) => {
          if (res.miniprogram) {
            console.log('å½“å‰åœ¨å¾®ä¿¡å°ç¨‹åºç¯å¢ƒ');
          }
        });
      }
    }
    
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    window.addEventListener('DOMContentLoaded', () => {
      initWechatMiniProgram();
      updateFileSelectionMode();
    });
  </script>
</body>
</html>
